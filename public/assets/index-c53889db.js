import{c3 as te,g as T,bV as R,u as G,aK as se,k as C,n as oe,t as U,y as L,v as _,ao as k,a9 as ne,bH as ae,cA as ie,c7 as le,a as D,d as B,c as F,h as H,cB as ce,r as S,aT as re,c8 as pe,c9 as de,Y as ue,ca as ve,A,ak as fe,H as K,az as me,J as he,E as z,F as M,G as e,S as u,Q as r,X as t,R as v,am as b,aA as ge,_ as $,O as _e,P as xe,bG as ye,a0 as O,L as ke,U as q,cC as we,as as Ce}from"./index-2efe4620.js";import{N as V}from"./Input-4816b01d.js";import{N as Pe}from"./Select-b45c26f7.js";import{a as be,N as E}from"./Tabs-d30e51ae.js";import"./Add-1eab33c9.js";const W=te("n-popconfirm"),Y={positiveText:String,negativeText:String,showIcon:{type:Boolean,default:!0},onPositiveClick:{type:Function,required:!0},onNegativeClick:{type:Function,required:!0}},J=le(Y),$e=T({name:"NPopconfirmPanel",props:Y,setup(n){const{localeRef:s}=R("Popconfirm"),{inlineThemeDisabled:c}=G(),{mergedClsPrefixRef:a,mergedThemeRef:d,props:m}=se(W),h=C(()=>{const{common:{cubicBezierEaseInOut:i},self:{fontSize:g,iconSize:x,iconColor:w}}=d.value;return{"--n-bezier":i,"--n-font-size":g,"--n-icon-size":x,"--n-icon-color":w}}),o=c?oe("popconfirm-panel",void 0,h,m):void 0;return Object.assign(Object.assign({},R("Popconfirm")),{mergedClsPrefix:a,cssVars:c?void 0:h,localizedPositiveText:C(()=>n.positiveText||s.value.positiveText),localizedNegativeText:C(()=>n.negativeText||s.value.negativeText),positiveButtonProps:U(m,"positiveButtonProps"),negativeButtonProps:U(m,"negativeButtonProps"),handlePositiveClick(i){n.onPositiveClick(i)},handleNegativeClick(i){n.onNegativeClick(i)},themeClass:o==null?void 0:o.themeClass,onRender:o==null?void 0:o.onRender})},render(){var n;const{mergedClsPrefix:s,showIcon:c,$slots:a}=this,d=L(a.action,()=>this.negativeText===null&&this.positiveText===null?[]:[this.negativeText!==null&&_(k,Object.assign({size:"small",onClick:this.handleNegativeClick},this.negativeButtonProps),{default:()=>this.localizedNegativeText}),this.positiveText!==null&&_(k,Object.assign({size:"small",type:"primary",onClick:this.handlePositiveClick},this.positiveButtonProps),{default:()=>this.localizedPositiveText})]);return(n=this.onRender)===null||n===void 0||n.call(this),_("div",{class:[`${s}-popconfirm__panel`,this.themeClass],style:this.cssVars},ne(a.default,m=>c||m?_("div",{class:`${s}-popconfirm__body`},c?_("div",{class:`${s}-popconfirm__icon`},L(a.icon,()=>[_(ae,{clsPrefix:s},{default:()=>_(ie,null)})])):null,m):null),d?_("div",{class:[`${s}-popconfirm__action`]},d):null)}}),Se=D("popconfirm",[B("body",`
 font-size: var(--n-font-size);
 display: flex;
 align-items: center;
 flex-wrap: nowrap;
 position: relative;
 `,[B("icon",`
 display: flex;
 font-size: var(--n-icon-size);
 color: var(--n-icon-color);
 transition: color .3s var(--n-bezier);
 margin: 0 8px 0 0;
 `)]),B("action",`
 display: flex;
 justify-content: flex-end;
 `,[F("&:not(:first-child)","margin-top: 8px"),D("button",[F("&:not(:last-child)","margin-right: 8px;")])])]),Ne=Object.assign(Object.assign(Object.assign({},H.props),ve),{positiveText:String,negativeText:String,showIcon:{type:Boolean,default:!0},trigger:{type:String,default:"click"},positiveButtonProps:Object,negativeButtonProps:Object,onPositiveClick:Function,onNegativeClick:Function}),Te=T({name:"Popconfirm",props:Ne,__popover__:!0,setup(n){const{mergedClsPrefixRef:s}=G(),c=H("Popconfirm","-popconfirm",Se,ce,n,s),a=S(null);function d(o){var i;if(!(!((i=a.value)===null||i===void 0)&&i.getMergedShow()))return;const{onPositiveClick:g,"onUpdate:show":x}=n;Promise.resolve(g?g(o):!0).then(w=>{var y;w!==!1&&((y=a.value)===null||y===void 0||y.setShow(!1),x&&A(x,!1))})}function m(o){var i;if(!(!((i=a.value)===null||i===void 0)&&i.getMergedShow()))return;const{onNegativeClick:g,"onUpdate:show":x}=n;Promise.resolve(g?g(o):!0).then(w=>{var y;w!==!1&&((y=a.value)===null||y===void 0||y.setShow(!1),x&&A(x,!1))})}return re(W,{mergedThemeRef:c,mergedClsPrefixRef:s,props:n}),{setShow(o){var i;(i=a.value)===null||i===void 0||i.setShow(o)},syncPosition(){var o;(o=a.value)===null||o===void 0||o.syncPosition()},mergedTheme:c,popoverInstRef:a,handlePositiveClick:d,handleNegativeClick:m}},render(){const{$slots:n,$props:s,mergedTheme:c}=this;return _(ue,de(s,J,{theme:c.peers.Popover,themeOverrides:c.peerOverrides.Popover,internalExtraClass:["popconfirm"],ref:"popoverInstRef"}),{trigger:n.activator||n.trigger,default:()=>{const a=pe(s,J);return _($e,Object.assign(Object.assign({},a),{onPositiveClick:this.handlePositiveClick,onNegativeClick:this.handleNegativeClick}),n)}})}});function Ie(){const n=new Date,s=n.getDate(),c=n.getMonth()+1;return`${n.getFullYear()}-${c}-${s}`}const ze={class:"p-4 space-y-5 min-h-[200px]"},Be={class:"space-y-6"},Oe={class:"flex items-center space-x-4"},je={class:"flex-shrink-0 w-[100px]"},Re={class:"flex-1"},Ue={class:"flex items-center space-x-4"},Le={class:"flex-shrink-0 w-[100px]"},De={class:"w-[200px]"},Fe={class:"flex-shrink-0 w-[100px]"},Ae={class:"flex flex-wrap items-center gap-4"},Me={class:"flex items-center space-x-4"},Ve={class:"flex-shrink-0 w-[100px]"},Ee={class:"flex flex-wrap items-center gap-4"},Je={class:"flex items-center space-x-4"},Ge={class:"flex-shrink-0 w-[100px]"},He={class:"flex flex-wrap items-center gap-4"},Ke=T({__name:"General",setup(n){const s=fe(),c=K(),{isMobile:a}=me(),d=he(),m=C(()=>s.theme),h=C(()=>c.userInfo),o=S(h.value.avatar??""),i=S(h.value.username??""),g=S(!1),x=C({get(){return s.language},set(l){s.setLanguage(l)}}),w=[{label:"Auto",key:"auto",icon:"ri:contrast-line"},{label:"Light",key:"light",icon:"ri:sun-foggy-line"},{label:"Dark",key:"dark",icon:"ri:moon-foggy-line"}],y=[{label:"简体中文",key:"zh-CN",value:"zh-CN"}];async function j(l){try{g.value=!0;const p=await ye(l);if(g.value=!1,!p.success)return d.error(p.message);d.success(O("common.updateUserSuccess")),c.getUserInfo()}catch{g.value=!1}}function Q(){const l=Ie(),p=localStorage.getItem("chatStorage")||"{}",f=JSON.stringify(JSON.parse(p),null,2),P=new Blob([f],{type:"application/json"}),I=URL.createObjectURL(P),N=document.createElement("a");N.href=I,N.download=`chat-store_${l}.json`,document.body.appendChild(N),N.click(),document.body.removeChild(N)}function X(l){const p=l.target;if(!p||!p.files)return;const f=p.files[0];if(!f)return;const P=new FileReader;P.onload=()=>{try{const I=JSON.parse(P.result);localStorage.setItem("chatStorage",JSON.stringify(I)),d.success(O("common.success")),location.reload()}catch{d.error(O("common.invalidFileFormat"))}},P.readAsText(f)}function Z(){localStorage.removeItem("chatStorage"),location.reload()}function ee(){const l=document.getElementById("fileInput");l&&l.click()}return(l,p)=>(z(),M("div",ze,[e("div",Be,[e("div",Oe,[e("span",je,u(l.$t("setting.avatarLink")),1),e("div",Re,[r(t(V),{value:o.value,"onUpdate:value":p[0]||(p[0]=f=>o.value=f),placeholder:"请填写头像地址"},null,8,["value"])]),r(t(k),{size:"tiny",disabled:g.value,text:"",type:"primary",onClick:p[1]||(p[1]=f=>j({avatar:o.value}))},{default:v(()=>[b(u(l.$t("common.update")),1)]),_:1},8,["disabled"])]),e("div",Ue,[e("span",Le,u(l.$t("setting.name")),1),e("div",De,[r(t(V),{value:i.value,"onUpdate:value":p[2]||(p[2]=f=>i.value=f),placeholder:"请填写用户名"},null,8,["value"])]),r(t(k),{size:"tiny",disabled:g.value,text:"",type:"primary",onClick:p[3]||(p[3]=f=>j({username:i.value}))},{default:v(()=>[b(u(l.$t("common.update")),1)]),_:1},8,["disabled"])]),e("div",{class:ge(["flex items-center space-x-4",t(a)&&"items-start"])},[e("span",Fe,u(l.$t("setting.chatHistory")),1),e("div",Ae,[r(t(k),{size:"small",onClick:Q},{icon:v(()=>[r(t($),{icon:"ri:download-2-fill"})]),default:v(()=>[b(" "+u(l.$t("common.export")),1)]),_:1}),e("input",{id:"fileInput",type:"file",style:{display:"none"},onChange:X},null,32),r(t(k),{size:"small",onClick:ee},{icon:v(()=>[r(t($),{icon:"ri:upload-2-fill"})]),default:v(()=>[b(" "+u(l.$t("common.import")),1)]),_:1}),r(t(Te),{placement:"bottom",onPositiveClick:Z},{trigger:v(()=>[r(t(k),{size:"small"},{icon:v(()=>[r(t($),{icon:"ri:close-circle-line"})]),default:v(()=>[b(" "+u(l.$t("common.clear")),1)]),_:1})]),default:v(()=>[b(" "+u(l.$t("chat.clearHistoryConfirm")),1)]),_:1})])],2),e("div",Me,[e("span",Ve,u(l.$t("setting.theme")),1),e("div",Ee,[(z(),M(_e,null,xe(w,f=>r(t(k),{key:f.key,size:"small",type:f.key===m.value?"primary":void 0,onClick:P=>t(s).setTheme(f.key)},{icon:v(()=>[r(t($),{icon:f.icon},null,8,["icon"])]),_:2},1032,["type","onClick"])),64))])]),e("div",Je,[e("span",Ge,u(l.$t("setting.language")),1),e("div",He,[r(t(Pe),{style:{width:"140px"},value:x.value,options:y,onUpdateValue:p[4]||(p[4]=f=>t(s).setLanguage(f))},null,8,["value"])])])])]))}}),qe={class:"p-4 space-y-5 min-h-[200px]"},We={class:"flex items-center space-x-4"},Ye=e("span",{class:"flex-shrink-0 w-[100px]"},"用户邮箱",-1),Qe={class:"w-[200px]"},Xe={class:"flex items-center space-x-4"},Ze=e("span",{class:"flex-shrink-0 w-[100px]"},"用户姓名",-1),et={class:"w-[200px]"},tt={class:"flex items-center space-x-4"},st=e("span",{class:"flex-shrink-0 w-[100px]"},"问答余额",-1),ot={class:"w-[200px]"},nt={class:"flex items-center space-x-4"},at=e("span",{class:"flex-shrink-0 w-[100px]"},"绘画余额",-1),it={class:"w-[200px]"},lt={class:"flex items-center space-x-4"},ct=e("span",{class:"flex-shrink-0 w-[100px]"},"MJToken",-1),rt={class:"w-[200px]"},pt={class:"flex items-center space-x-4"},dt=e("span",{class:"flex-shrink-0 w-[100px]"},"使用金额",-1),ut={class:"w-[200px]"},vt=T({__name:"Personal",setup(n){const s=K(),{userInfo:c,userBalance:a}=s,d=S(!1);ke(async()=>{m()});async function m(){try{d.value=!0,await s.getUserInfo(),d.value=!1}catch{d.value=!1}}return(h,o)=>(z(),q(t(we),{show:d.value},{default:v(()=>[e("div",qe,[e("div",We,[Ye,e("div",Qe,u(t(c).email||"--"),1)]),e("div",Xe,[Ze,e("div",et,u(t(c).username||"--"),1)]),e("div",tt,[st,e("div",ot,u(t(a).usesLeft||"0")+" 积分 ",1)]),e("div",nt,[at,e("div",it,u(t(a).paintCount||"0")+" 积分 ",1)]),e("div",lt,[ct,e("div",rt,u(t(a).balance||"0")+" Token ",1)]),e("div",pt,[dt,e("div",ut,u(t(a).useTokens||"0")+" Token ",1)])])]),_:1},8,["show"]))}}),ft={class:"ml-2"},mt={class:"ml-2"},ht={class:"min-h-[100px]"},wt=T({__name:"index",props:{visible:{type:Boolean}},emits:["update:visible"],setup(n,{emit:s}){const c=n,a=s,d=S("personalInfo"),m=C({get(){return c.visible},set(h){a("update:visible",h)}});return(h,o)=>(z(),q(t(Ce),{show:m.value,"onUpdate:show":o[1]||(o[1]=i=>m.value=i),title:"个人中心","auto-focus":!1,preset:"card",style:{width:"95%","max-width":"640px"}},{default:v(()=>[e("div",null,[r(t(be),{value:d.value,"onUpdate:value":o[0]||(o[0]=i=>d.value=i),type:"line",animated:""},{default:v(()=>[r(t(E),{name:"personalInfo",tab:"personalInfo"},{tab:v(()=>[r(t($),{class:"text-lg",icon:"ri:file-user-line"}),e("span",ft,u(h.$t("setting.personalInfo")),1)]),default:v(()=>[r(vt)]),_:1}),r(t(E),{name:"General",tab:"General"},{tab:v(()=>[r(t($),{class:"text-lg",icon:"ri:list-settings-line"}),e("span",mt,u(h.$t("setting.general")),1)]),default:v(()=>[e("div",ht,[r(Ke)])]),_:1})]),_:1},8,["value"])])]),_:1},8,["show"]))}});export{wt as default};
